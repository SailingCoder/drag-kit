!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).DragKit={})}(this,(function(t){"use strict";var i=Object.defineProperty,s=(t,s,h)=>((t,s,h)=>s in t?i(t,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):t[s]=h)(t,"symbol"!=typeof s?s+"":s,h);const h="SailingDraggablePositions";const e=class t{constructor(i,h={}){var e,o;s(this,"element"),s(this,"shouldSave"),s(this,"minX"),s(this,"minY"),s(this,"maxX"),s(this,"maxY"),s(this,"diffX"),s(this,"diffY"),s(this,"mouseMoveHandler"),s(this,"mouseUpHandler"),s(this,"observerElement"),s(this,"config"),s(this,"initialPosition"),this.element=i,this.shouldSave=h.shouldSave||!1,this.minX=0,this.minY=0,this.maxX=window.innerWidth-i.offsetWidth,this.maxY=window.innerHeight-i.offsetHeight,this.diffX=0,this.diffY=0,this.mouseMoveHandler=null,this.mouseUpHandler=null,this.observerElement=null,this.config={...t.defaultOptions,...h},this.initialPosition={x:(null==(e=h.initialPosition)?void 0:e.x)||"0px",y:(null==(o=h.initialPosition)?void 0:o.y)||"0px"},this.init()}updateBounds(){if(this.config.dragArea){"static"===getComputedStyle(this.config.dragArea).position&&(this.config.dragArea.style.position="relative"),this.element.style.position="absolute";const{width:t,height:i}=this.config.dragArea.getBoundingClientRect();this.maxX=t-this.element.offsetWidth,this.maxY=i-this.element.offsetHeight}else"screen"===this.config.mode?(this.element.style.position="fixed",this.maxX=window.innerWidth-this.element.offsetWidth,this.maxY=window.innerHeight-this.element.offsetHeight):"page"===this.config.mode&&(this.element.style.position="absolute",this.maxX=document.documentElement.scrollWidth-this.element.offsetWidth,this.maxY=document.documentElement.scrollHeight-this.element.offsetHeight)}onMouseDown(t){t.preventDefault(),t.stopPropagation(),this.diffX=t.clientX-this.element.offsetLeft,this.diffY=t.clientY-this.element.offsetTop;const i=document.getElementsByTagName("iframe");for(const s of i)s.style.pointerEvents="none";void 0!==this.element.setCapture&&this.element.setCapture(),this.mouseMoveHandler=this.onMouseMove.bind(this),this.mouseUpHandler=this.onMouseUp.bind(this),document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseup",this.mouseUpHandler),this.config.onDragStart&&this.config.onDragStart(this.element)}onMouseMove(t){t.preventDefault();let i=t.clientX-this.diffX,s=t.clientY-this.diffY;"x"===this.config.lockAxis?s=this.element.offsetTop:"y"===this.config.lockAxis&&(i=this.element.offsetLeft),"container"===this.config.mode&&this.config.dragArea?this.updateBounds():"screen"===this.config.mode?(this.maxX=window.innerWidth-this.element.offsetWidth,this.maxY=window.innerHeight-this.element.offsetHeight):"page"===this.config.mode&&(this.maxX=document.documentElement.scrollWidth-this.element.offsetWidth,this.maxY=document.documentElement.scrollHeight-this.element.offsetHeight);const h=this.config.edgeBuffer||0;if(i<this.minX-h&&(i=this.minX-h),i>this.maxX+h&&(i=this.maxX+h),s<this.minY-h&&(s=this.minY-h),s>this.maxY+h&&(s=this.maxY+h),this.config.gridSize){const t=this.config.gridSize||1;i=Math.round(i/t)*t,s=Math.round(s/t)*t}this.element.style.left=i+"px",this.element.style.top=s+"px",this.config.onDrag&&this.config.onDrag(this.element)}onMouseUp(){if(this.config.snapMode&&"none"!==this.config.snapMode){const t=this.config.edgeBuffer||0,i=this.element.getBoundingClientRect();let s,h;if("screen"===this.config.mode)s=window.innerWidth,h=window.innerHeight;else if("page"===this.config.mode)s=document.documentElement.scrollWidth,h=document.documentElement.scrollHeight;else if("container"===this.config.mode&&this.config.dragArea){const t=this.config.dragArea.getBoundingClientRect();s=t.width,h=t.height}else s=window.innerWidth,h=window.innerHeight;const e=this.element.offsetLeft,o=s-(this.element.offsetLeft+i.width),n=this.element.offsetTop,l=h-(this.element.offsetTop+i.height);if("auto"===this.config.snapMode){const u=Math.min(e,o,n,l);u===e?this.element.style.left=t+"px":u===o?this.element.style.left=s-i.width-t+"px":u===n?this.element.style.top=t+"px":u===l&&(this.element.style.top=h-i.height-t+"px")}else"right"===this.config.snapMode?this.element.style.left=s-i.width-t+"px":"left"===this.config.snapMode?this.element.style.left=t+"px":"top"===this.config.snapMode?this.element.style.top=t+"px":"bottom"===this.config.snapMode&&(this.element.style.top=h-i.height-t+"px")}const t=document.getElementsByTagName("iframe");for(const i of t)i.style.pointerEvents="";this.savePosition(),document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseup",this.mouseUpHandler),void 0!==this.element.releaseCapture&&this.element.releaseCapture(),this.config.onDragEnd&&this.config.onDragEnd(this.element)}savePosition(){this.shouldSave&&function(t,i){if(!i)return;const s=JSON.parse(localStorage.getItem(h)||"{}"),e=t.id,o={left:t.style.left,top:t.style.top};s[e]=o,localStorage.setItem(h,JSON.stringify(s))}(this.element,this.shouldSave)}restorePosition(){!function(t,i,s){if(i){const i=JSON.parse(localStorage.getItem(h)||"{}"),e=t.id;if(i[e]){const s=i[e];t.style.left=s.left||"0px",t.style.top=s.top||"0px"}else t.style.left=s.initialPosition.x,t.style.top=s.initialPosition.y}else t.style.left=s.initialPosition.x,t.style.top=s.initialPosition.y}(this.element,this.shouldSave,{initialPosition:this.initialPosition})}observeElementVisibility(t){this.observerElement=new MutationObserver(i=>{i.forEach(i=>{"style"===i.attributeName&&"none"===t.style.display&&(t.style.display="block")})}),this.observerElement.observe(t,{attributes:!0,attributeFilter:["style"]})}init(){this.restorePosition(),this.element.onmousedown=this.onMouseDown.bind(this),window.addEventListener("resize",this.updateBounds.bind(this)),this.updateBounds(),this.observeElementVisibility(this.element)}destroy(){try{this.element.onmousedown=null,this.mouseMoveHandler&&(document.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseMoveHandler=null),this.mouseUpHandler&&(document.removeEventListener("mouseup",this.mouseUpHandler),this.mouseUpHandler=null),window.removeEventListener("resize",this.updateBounds),this.observerElement&&(this.observerElement.disconnect(),this.observerElement=null)}catch(t){}}};s(e,"defaultOptions",{shouldSave:!1,onDragStart:void 0,onDrag:void 0,onDragEnd:void 0,dragArea:void 0,lockAxis:void 0,edgeBuffer:0,gridSize:void 0,mode:"screen",snapMode:"none"});let o=e;t.createDraggable=function(t,i={}){const s=document.getElementById(t);return s?(getComputedStyle(s).display,i.mode&&!["screen","page","container"].includes(i.mode)||"container"===i.mode&&!i.dragArea||i.dragArea&&"container"!==i.mode?null:window.self!==window.top?(s.remove(),null):("none"===getComputedStyle(s).display&&(s.style.display="block"),s.dataset.draggableInitialized?null:(s.dataset.draggableInitialized="true",new o(s,i)))):null},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
